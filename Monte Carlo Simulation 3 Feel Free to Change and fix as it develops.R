
#Risk-Free Interest Rate
#Might Change
#52-Week T-Bill Rates https://ycharts.com/indicators/1_year_treasury_rate
#Long-Term Average
r=.02856

#Dividend Yield
#Might Change to Mutual Fund Rates or something else
div=.0185

#Volatility
#If able find time frame and get calculations based on different Ts
#https://www.barchart.com/stocks/quotes/$SPX/options?expiration=2022-11-18-w&view=stacked&moneyness=10
vol=.2666

#SPX Last 10 Years Low --> High
#https://www.barchart.com/stocks/quotes/$SPX/interactive-chart
#S0<- 1398:4818
#S0 = c(1500,2000,2500,3000,3500,4000,4500,5000,5500
S0=3500
n1 = length(S0)
  
#Maturity Times Vector
#t= c(1/12,2/12,3/12,4/12,5/12,6/12,7/12,8/12,9/12,10/12,11,12,1,2,3,4,5,6,7,8,9,10)
t=.5
n2 = length(t)

#Strike Prices
#Should the Strike Price Range Be Changed
#K = 2000:7000
#K = c(2000,3000,4000,5000,6000,7000)
K=2000
n3 = length(K)

#D1Values = NULL
#D Values
#for (i in 1:n1)
#{
 # for (j in 1:n2)
 # {
   # for(w in 1:n3)
     # d1 = ((log(S0[i]/K[w]) + (r-div+(vol^2/2))*t[j])/(vol * sqrt(t[j])))
  
   # D1values = c(d1)
#  }
#}
#D1Values[1:10]
d1= ((log(S0/K)+ (r-div+(vol^2/2))*t)/(vol * sqrt(t)))
d2= (d1 - vol*sqrt(t))

#Theoretical Delta "Derivative of BScall in terms of S"
delta=(exp(-div*t)*pnorm(d1))
#Theoretical Call 
BScall= (S0*exp(-div*t)*pnorm(d1))-(K*exp(-r*t)*pnorm(d2))


#------------------------------------------------------------------
#Monte-Carlo Estimation

#Algorithm 1
#Generate a vector of 5000 normally distributed random numbers
Zi=rnorm(5000)
#5.1.16 5-14
#Check if I am implementing the Z tilde right
for(i in 1:5000)
{
  St = (S0 * (exp((r-div-((vol^2)/2))*t) + (vol * sqrt(t) *Zi)))
}
#St = (S0 * (exp((r-div-((vol^2)/2))*t) + (vol * sqrt(t) *Zi)))
#Eat something and fix this loop
#-----------------------------------------------------------
for (i in 1:5000)
{
  calltermnialpayoff = max((St[i]-K),0)
}
#calltermnialpayoff = max((St-K),0)
callpayoff = exp(-r*t) * calltermnialpayoff
calltermnialpayoff
#---------------------------------------------------------------------

#Do T-
#Little t will be 0 in our case.........................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
Nd1prime = exp(-d1^2/2)*(1/sqrt(2*pi))
Nd2prime = exp(-d2^2/2)*(1/sqrt(2*pi))

#Gamma and Theta Formulas for option Greeks
Gamma = ((exp(-div*t) * Nd1prime) / (St * vol * sqrt(t)))

Theta =  ((div * St * exp(-div *t) * pnorm(d1)) - (r * K *exp(-r*t) * pnorm(d2)) - ((K * exp(-r*t) * Nd2prime * vol) / (2 * sqrt(t))))





#----------------------------------------------------------------------------
#To Be Moved to more efficent place in code

#Price of a Asset or Nothing Call
AoNCallPrice = S0 * exp(-div*t) * pnorm(d1)

#Shows Derivative of Price W/ Steps
#Perhaps Relationship
#https://quantpie.co.uk/bsm_bin_a_formula/bs_bin_a_delta.php
#Asset or Nothing Options' Greeks under Black Scholes
#Derivative of Price wrt S
AoNCallDelta = ((((exp(-r*t)) / (vol * sqrt(t))) * pnorm(d1)) + ((exp(-r*t)) * pnorm(d1)))








#READ THIS
#OK so I am interpreting things in two ways and there should only be one and both might be wrong but 
#Component 2 in the slides is "Specify how you use the emperical expectations to find the price and delta.
#"Hint what is E*[S(T)I(S(T)>K)] and what is its relationship with Delta
#This looks to be a partial expectation for price of a regular call  but this is also similar to the Asset or Nothing Call payoof and then price I might be fixating so if someone can explain away my confusion
#I am going to code out as if it isnt the Asset or nothing Call using content from 5.1 M5-17




#-------------------------------------------------------------
#payoff=NULL
#for(i in 1: 5000)
#{
#  payoff=c(payoff, ifelse(St[i]>k,St[i]-K,0))
#  }
#clapply

#price=mean(payoff)
#-------------------------------------------------------------









